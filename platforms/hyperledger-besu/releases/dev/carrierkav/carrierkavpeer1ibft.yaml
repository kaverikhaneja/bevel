apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: carrierkavpeer1ibft
  namespace: carrierkav-bes
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: carrierkavpeer1ibft
  chart:
    git: https://github.com/kaverikhaneja/blockchain-automation-framework.git
    ref: besu-privateTx
    path: platforms/hyperledger-besu/charts/node_orion 
  values:
    replicaCount: 1

    healthcheck:
      readinessthreshold: 100
      readinesscheckinterval: 5

    staticnodes:
      - "enode://ad637076ee0dca3e0df2b5d475fb654dd2df2b925eabe4910b2ad5b367f8ac116113a17b5d9a81b27f34f2e28843b52f294de5c1b4588c9b8fa998b24c04ba52@validator1.bes.dev2.aws.blockchaincloudpoc-develop.com:15041"
      - "enode://430c5aa1fad505249e82b879d3180a0aea9c11a4554cb654854a91d1cc30f2a5c1696f77cddf8e95b7ddc6e840298d77853b2277521fd7ba43597bc160fa53e7@validator2.bes.dev2.aws.blockchaincloudpoc-develop.com:15043"
      - "enode://d6ec14194732ac635366abb092389d845c2d82698aefa79b22a1cf92ee4d48c3df3ce491790595530da378560f902dfb49f8fac2141d98ef04bfc46eab7aa618@validator3.bes.dev2.aws.blockchaincloudpoc-develop.com:15045"
      - "enode://cd142c85951736c9a592edc77986d05f390d5d4099870b4d511287e9a1b0bc6603af7578ea43c0d91018249bbb5e1928c0ccbc47f8834103f35e99d6ec8320be@validator4.bes.dev2.aws.blockchaincloudpoc-develop.com:15047"
      - "enode://b7e6bcf38fac02688a7ec0ecfd0e5036e508cc710e8cab967610592db286b698215780eab95f20ce4b93ec508eca010c97dc524dede1ae51d485f0e6d2ae775f@peer1.bes.dev2.aws.blockchaincloudpoc-develop.com:15049"
      - "enode://9ffce773034e4dd9f1aa899632f6f0527cfac96cbd746fec56942e70bb3fc6f727a70c8e6063a642813aba84351297da647bb68e5ca7e583f2e93c77c3c0829a@peer2.bes.dev2.aws.blockchaincloudpoc-develop.com:15062"
      - "enode://bd79c146bc60686cd1c7a95112eae12d2e703579d7bb0bbb4af28b18a2a4363a8c66937624a067dd76ae2e7b6b71b044f6172dc81cdac16b362a6e0ddb234478@peer3.bes.dev2.aws.blockchaincloudpoc-develop.com:15065"
      - "enode://9c54bbcddaa4569857c15ca9babc816093459a95d11272b62ce2136e97550da000f0127bf9e9f6d99ea0107751c11890f1d882f26a5f0b8bd935cb970e0d61e9@peer4.bes.dev2.aws.blockchaincloudpoc-develop.com:15068"

    metadata:
      namespace: carrierkav-bes
      labels:

    liveliness_check:
      enabled: false
 
    proxy:
      provider: ambassador
      external_url: carrierkav.bes.dev2.aws.blockchaincloudpoc-develop.com
      p2p: 15049
      rpc: 15050
      tmport: 15061

    images:
      node: hyperledger/besu:21.1.1
      alpineutils: hyperledgerlabs/alpine-utils:1.0
      orion: pegasyseng/orion:21.1.1

    node:
      name: peer1
      consensus: ibft
      subject: O=Carrier,OU=Carrier,L=51.50/-0.13/London,C=GB
      mountPath: /opt/besu/data
      servicetype: ClusterIP
      imagePullSecret: regcred
      ports:
        p2p: 30303
        rpc: 8545
        ws: 8546

    orion:
      name: orion
      tls: True
      confdir: /etc/config
      url: "https://carrierkav.bes.dev2.aws.blockchaincloudpoc-develop.com"
      nodelist: "\"https://peer2.bes.dev2.aws.blockchaincloudpoc-develop.com:15064\",\"https://peer3.bes.dev2.aws.blockchaincloudpoc-develop.com:15067\",\"https://peer4.bes.dev2.aws.blockchaincloudpoc-develop.com:15070\""
      trust: ca-or-tofu
      ports:
        nodeport: 8888
        clientport: 8080

    storage:
      storageclassname: awsstorageclass
      storagesize: 1Gi

    vault:
      address: http://vault.internal.dev2.aws.blockchaincloudpoc-develop.com:20001
      secretprefix: secretsv2/data/carrierkav-bes/crypto/peer1
      serviceaccountname: vault-auth
      keyname: data
      tmdir: tm
      tlsdir: tls
      role: vault-role
      authpath: besucarrierkav

    genesis: ewogICJjb25maWciOiB7CiAgICAiY2hhaW5JZCI6IDIwMTgsCiAgICAiY29uc3RhbnRpbm9wbGVmaXhibG9jayI6IDAsCiAgICAiY29udHJhY3RTaXplTGltaXQiOiAyMTQ3NDgzNjQ3LAogICAgImliZnQyIjogewogICAgICAiYmxvY2twZXJpb2RzZWNvbmRzIjogMiwKICAgICAgImVwb2NobGVuZ3RoIjogMzAwMDAsCiAgICAgICJyZXF1ZXN0dGltZW91dHNlY29uZHMiOiAxMAogICAgfQogIH0sCiAgIm5vbmNlIjogIjB4MCIsCiAgInRpbWVzdGFtcCI6ICIweDU4ZWU0MGJhIiwKICAiZ2FzTGltaXQiOiAiMHgxZmZmZmZmZmZmZmZmZiIsCiAgImRpZmZpY3VsdHkiOiAiMHgxIiwKICAiZXh0cmFEYXRhIjogIjB4Zjg3ZWEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGY4NTQ5NDI1ODEyNjUxMDdiYmI4NzQzZjgwOGQyZjdhZjk2YWI1M2YwODY4OWM5NGQzNTk2YzlkMWM4ZDZmNjg4MzE3YWM1OGVjNWZlM2I2ZGNiYWExMzM5NGViOTAxYTlhM2I5ODUzMjIyN2ZlMTczOTYwMzFjYmEwMzk5YzBmNjM5NDBjZTY1Y2U2ZWI2ZjM1NjgxYjkwOGU5N2NiMTk0OTM3YWVmNWEzMjI4MDg0MDAwMDAwMDBjMCIKfQ==
